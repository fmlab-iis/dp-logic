
\begin{algorithm}
  \begin{algorithmic}[1]
    \Function{Subsampling}{$d$, $f$}
    \Require{$d \in \{ R, B \}^3$, $f : \{ R, B \}^3 \rightarrow \{ R,
      B \}$}
    \State{Subsample $m$ data sets $\hat{d}_1, \hat{d}_2, \ldots,
      \hat{d}_m$ from $d$ where each row of $d$ is chosen with
      probability $q$}
    \State{$z \leftarrow \{ f (\hat{d}_1), f (\hat{d}_2), \ldots, f
      (\hat{d}_m) \}$}
    \State{$\mathit{count}_R, \mathit{count}_B \leftarrow 
            | \{ i : f (\hat{d}_i) = R \} |,
            | \{ i : f (\hat{d}_i) = B \} |$}
    \State{$r \leftarrow | \mathit{count}_R - \mathit{count}_B | /
      (4mq) - 1$}
    \If{${r} + \mathit{Lap}(\frac{1}{\epsilon}) > \ln (1/\delta)/\epsilon$}
      \State{\textbf{if} $\mathit{count}_R \geq \mathit{count}_B$
             \textbf{then} \Return { $R$ } \textbf{else} \Return {$B$} } 
    \Else
      \State{\Return {$\bot$}}
    \EndIf
  \EndFunction
  \end{algorithmic}
  \caption{Subsampling}
  \label{algorithm:subsampling}
\end{algorithm}

\begin{figure}
  \centering
    \resizebox{.9\columnwidth}{!}{
    \begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node
      distance=2cm,node/.style={circle,draw}]

      \node[node] (rrr) at (-5,  2.25) { $rrr$ };
%      \node at (-4.4, 2) { $\vdots$ };
      \node[node] (rrb) at (-5,  0.75) { $rrb$ };
%      \node at (-4.4, .75) { $\vdots$ };
      \node[node] (rbb) at (-5, -0.75) { $rbb$ };
%      \node at (-4.4, -.5) { $\vdots$ };
      \node[node] (bbb) at (-5, -2.25) { $bbb$ };
%      \node at (-4.4, -1.75) { $\vdots$ };

      \node[node] (rmb0) at (-2.5,  2.25) { $m,0$ };
      \node at (-2.5, 0) { $\vdots$ };
      \node[node] (r0bm) at (-2.5, -2.25) { $0,m$ };

      \node[node] (Rm) at (0,  1.5) { $r_m$ };
      \node at (0, 0) { $\vdots$ };
      \node[node] (RM) at (0, -1.5) { $r_M$ };

      \node[node] (top) at (2.5,  0.75) { $\mathit{out}$ };
      \node[node] (bot) at (2.5, -0.75) { $\bot$ };

      \node[node] (outR) at (5,  1.25) { $R$ };
      \node[node] (outB) at (5, .25) { $B$ };

      \path
      (rrr) edge node [above] { } (rmb0)
      (rrr) edge node [above] { } (r0bm)
      (rrb) edge node [above] { } (rmb0)
      (rrb) edge node [above] { } (r0bm)
      (rbb) edge node [above] { } (rmb0)
      (rbb) edge node [above] { } (r0bm)
      (bbb) edge node [above] { } (rmb0)
      (bbb) edge node [above] { } (r0bm)

      (rmb0) edge node [above] {} (RM)
      (r0bm) edge node [above] {} (RM)

      (Rm) edge node [above] {} (top)
      (Rm) edge node [above] {} (bot)
      (RM) edge node [above] {} (top)
      (RM) edge node [above] {} (bot)

      (top) edge (outR)
      (top) edge (outB)
      ;

      \end{tikzpicture}
    }
  \caption{Markov Chain for Subsampling}
  \label{figure:mc-subsampling}
\end{figure}
